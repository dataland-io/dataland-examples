moduleId: airtable-multi-table-sync

info:
  title: Airtable Multi-Table Sync
  description: Sync multiple tables from Airtable to Dataland
  author: Dataland Devs <support@dataland.io>
  sourceCodeUrl: https://github.com/dataland-io/dataland-builtin-modules
  readmePath: README.md
  iconPath: icon.svg

buildCommand: npm run build

parameters:
  - airtable-api-key
  - airtable-allow-writeback-boolean
  - airtable-sync-mapping-json

# Create a .env file in the root of this folder
# with the following contents:
# DL_PARAM_AIRTABLE_API_KEY=<your-api-key>
# DL_PARAM_AIRTABLE_ALLOW_WRITEBACK_BOOLEAN=<your-allow-writeback-boolean>
# DL_PARAM_AIRTABLE_SYNC_MAPPING_JSON=<your-sync-mapping-json>
# See readme for the format of the SYNC MAPPING JSON

workers:
  - workerId: airtable-multi-table-sync-worker
    scriptPath: dist/main.bundle.js
    triggers:
      transaction: {}
      cron:
        cronExpression: "0 */5 * * * * *"
    env:
      AIRTABLE_API_KEY: airtable-api-key
      AIRTABLE_ALLOW_WRITEBACK_BOOLEAN: airtable-allow-writeback-boolean
      AIRTABLE_SYNC_MAPPING_JSON: airtable-sync-mapping-json

tables:
  - tableName: airtable_orders
    autoMigrate: true
    columnDescriptors:
      - columnName: record_id
        dataType: string
        columnAnnotations:
          dataland.io/column-width: "100"

      - columnName: order_id
        dataType: float64
        columnAnnotations:
          dataland.io/column-width: "100"

      - columnName: status
        dataType: string
        columnAnnotations:
          dataland.io/column-display-config: |
            {
              "type": "select",
              "options": [
                {
                  "value": "Todo",
                  "theme": "silver"
                },
                {
                  "value": "Fulfilled",
                  "theme": "green"
                },
                {
                  "value": "Refunded",
                  "theme": "ruby"
                }
              ]
            }

      - columnName: amount
        dataType: float64
        columnAnnotations:
          dataland.io/read-only: true
          dataland.io/column-width: "100"

      - columnName: order_item
        dataType: string
        columnAnnotations:
          dataland.io/read-only: true
          dataland.io/column-width: "100"

      - columnName: size
        dataType: string
        columnAnnotations:
          dataland.io/column-width: "100"
          dataland.io/column-display-config: |
            {
              "type": "select",
              "options": [
                {
                  "value": "S",
                  "theme": "silver"
                },
                {
                  "value": "M",
                  "theme": "silver"
                },
                {
                  "value": "L",
                  "theme": "silver"
                },
                {
                  "value": "XL",
                  "theme": "silver"
                }
              ]
            }

      - columnName: shipping_provider
        dataType: string
        columnAnnotations:
          dataland.io/column-width: "140"
          dataland.io/column-display-config: |
            {
              "type": "select",
              "options": [
                {
                  "value": "UPS",
                  "theme": "light-blue"
                },
                {
                  "value": "FedEx",
                  "theme": "light-blue"
                },
                {
                  "value": "USPS",
                  "theme": "light-blue"
                }
              ]
            }

      - columnName: customers
        dataType: string

      - columnName: customization_notes
        dataType: string
        columnAnnotations:
          dataland.io/read-only: true

      - columnName: notes_from_staff
        dataType: string
